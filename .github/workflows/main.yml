name: License Server CI/CD

on:
  push:
    branches: [master]

permissions: write-all

jobs:
  test:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3
        with:
          fetch-depth: 0
          
      - name: Bump version and push tag
        id: tag_version
        uses: mathieudutour/github-tag-action@v6.0
        with:
          github_token: ${{ secrets.GITHUB_TOKEN }}

      # - name: Get Latest Release commit hash
      #   id: get_commit
      #   uses: actions/github-script@0.9.0
      #   with:
      #     script: |
      #       const commit = "${{fromJSON(steps.release_details.outputs.assets)[0].name}}".split('-').pop().split('.').shift();
      #       core.setOutput('commit', commit);
      
      # - name: Create Release Notes from commit history
      #   id: list_messages
      #   run: git log --pretty=format:%s --ancestry-path ${{steps.get_commit.outputs.commit}}^..${{steps.hash.outputs.hash}} > ReleaseNotes.txt

      - name: Create a GitHub release
        uses: ncipollo/release-action@v1
        with:
          tag: ${{ steps.tag_version.outputs.new_tag }}
          name: Release ${{ steps.tag_version.outputs.new_tag }}
          # bodyFile: "./ReleaseNotes.txt" 
          # artifacts: 'LS-release-${{github.run_number}}-${{steps.date.outputs.date}}-${{steps.hash.outputs.hash}}.zip'
          token: ${{ secrets.GITHUB_TOKEN }}